<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="_lib.html">

<dom-module id="app-shell">
    <template>
        <link rel="stylesheet" href="../styles/app.css">

        <div class="bubble_cloud" id="bubble_cloud1"></div>

        <div class$="content-wrapper party-[[ activeParty ]]">
            <div class="tab-wrapper">
                <div class="tab-bar">
                    <iron-selector attr-for-selected="data-select"
                                   selected="{{ activeParty }}"
                                   fallback-selection="all"
                                   class="clearfix">
                        <div class="tab party-all" data-select="all">Alle</div>
                        <template is="dom-repeat" items="[[ parties ]]">
                            <div class$="tab party-[[ item ]]" data-select="[[ item ]]">[[ getPartyName(item) ]]</div>
                        </template>
                    </iron-selector>
                </div>
                <span class="topline"></span>
            </div>
        </div>
    </template>
</dom-module>

<script>
    const partyMap = {
        cdu: "CDU",
        spd: "SPD",
        gruene: "GrÃ¼ne",
        fdp: "FDP",
        linke: "Linke",
        piraten: "Piraten",
        afd: "AFD"
    };

    class AppShell extends Polymer.Element {
        static get is() {
            return 'app-shell';
        }

        static get properties() {
            return {
                parties: {
                    type: Array,
                    value: () => ['cdu', 'spd', 'linke', 'gruene', 'fdp', 'piraten', 'afd']
                },
                activeParty: {
                    type: String
                },
                activeWord: {
                    type: String,
                    value: () => ""
                },
                partyMap: {
                    type: Object,
                    value: () => partyMap
                }
            };
        }

        connectedCallback() {
            super.connectedCallback();

            const elem = this.shadowRoot.querySelector('#bubble_cloud1');

            fetch('output/all.json')
                .then(res => res.json())
                .then(json => {
                    const bubbles = json.data.slice(0, 30);

                    BubbleCloud(partyMap)(elem, bubbles.map((item, key) => { return {
                        id: key,
                        word: item.word,
                        count: item.count,
                        share: item.share,
                        party_counts: _.mapValues(item.segments, d => d.share)
                    }; }));
                });
        }

        getPartyName(slug) {
            return partyMap[slug];
        }
    }

    customElements.define(AppShell.is, AppShell);
</script>